# .github/workflows/01-claude-implementation.yml
name: ğŸ¤– Claude Auto Implementation

on:
  workflow_dispatch:
    inputs:
      feature:
        description: 'Feature to implement'
        required: true
        type: choice
        options:
          - F1-èµ·å‹•ç”»é¢
          - F2-éŸ³å£°éŒ²éŸ³
          - F3-æ–‡å­—èµ·ã“ã—
          - F4-AIåŒ»ç™‚ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
          - F5-éŸ³å£°åˆæˆ
          - F6-ãƒ‡ãƒ¼ã‚¿ä¿å­˜
          - F7-ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
          - F8-ã‚ªãƒ•ãƒ©ã‚¤ãƒ³
          - ALL-å…¨æ©Ÿèƒ½
  
  schedule:
    - cron: '0 */6 * * *'  # 6æ™‚é–“ã”ã¨ã«è‡ªå‹•å®Ÿè¡Œ

jobs:
  implement-with-claude:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Load Feature Specification
        id: feature
        run: |
          FEATURE_ID=$(echo "${{ github.event.inputs.feature }}" | cut -d'-' -f1)
          echo "feature_id=${FEATURE_ID}" >> $GITHUB_OUTPUT
          
          # ä»•æ§˜æ›¸ã‹ã‚‰è©²å½“æ©Ÿèƒ½ã®è©³ç´°ã‚’æŠ½å‡º
          python3 -c "
          import yaml
          with open('voice-koereq-spec.yaml', 'r', encoding='utf-8') as f:
              spec = yaml.safe_load(f)
          
          feature = next(f for f in spec['features'] if f['id'] == '${FEATURE_ID}')
          print(f\"feature_name={feature['name']}\")
          print(f\"feature_type={feature['type']}\")
          print(f\"feature_priority={feature['priority']}\")
          " >> $GITHUB_OUTPUT
      
      # iOSå®Ÿè£…
      - name: Generate iOS Implementation
        uses: NikoToRA/claude-code-action@main
        with:
          prompt: |
            voice-koereq iOS ã‚¢ãƒ—ãƒªã® SwiftUI å®Ÿè£…ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

            æ©Ÿèƒ½: ${{ steps.feature.outputs.feature_name }} (${{ steps.feature.outputs.feature_id }})
            ã‚¿ã‚¤ãƒ—: ${{ steps.feature.outputs.feature_type }}

            è¦ä»¶:
            - SwiftUI ã¨ Combine ã‚’ä½¿ç”¨
            - iOS 16+ å¯¾å¿œ
            - Azure Speech SDK ã‚’çµ±åˆ
            - æ—¥æœ¬èªUIã‚’å„ªå…ˆ
            - ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’å«ã‚€
            - ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ
            - MVVM ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

            ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:
            1. Views/${{ steps.feature.outputs.feature_id }}View.swift - SwiftUIãƒ“ãƒ¥ãƒ¼
            2. ViewModels/${{ steps.feature.outputs.feature_id }}ViewModel.swift - ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ‡ãƒ«
            3. Services/${{ steps.feature.outputs.feature_id }}Service.swift - ã‚µãƒ¼ãƒ“ã‚¹å±¤

            å®Œå…¨ã«å‹•ä½œã™ã‚‹Swiftã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
          output_path: ios/VoiceKoereq/
      
      # Androidå®Ÿè£…
      - name: Generate Android Implementation
        uses: NikoToRA/claude-code-action@main
        with:
          prompt: |
            voice-koereq Android ã‚¢ãƒ—ãƒªã® Jetpack Compose å®Ÿè£…ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

            æ©Ÿèƒ½: ${{ steps.feature.outputs.feature_name }} (${{ steps.feature.outputs.feature_id }})
            ã‚¿ã‚¤ãƒ—: ${{ steps.feature.outputs.feature_type }}

            è¦ä»¶:
            - Jetpack Compose ã¨ Kotlin ã‚’ä½¿ç”¨
            - Material Design 3
            - Azure Speech SDK for Android ã‚’çµ±åˆ
            - Coroutines ã¨ Flow ã§éåŒæœŸå‡¦ç†
            - Hilt ã§ DI
            - æ—¥æœ¬èªUIã‚’å„ªå…ˆ

            ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:
            1. ui/${{ steps.feature.outputs.feature_id }}Screen.kt - Compose UI
            2. viewmodel/${{ steps.feature.outputs.feature_id }}ViewModel.kt - ViewModel
            3. repository/${{ steps.feature.outputs.feature_id }}Repository.kt - ãƒªãƒã‚¸ãƒˆãƒª

            å®Œå…¨ã«å‹•ä½œã™ã‚‹Kotlinã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
          output_path: android/app/src/main/kotlin/com/voicekoereq/
      
      # å…±æœ‰ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆKotlin Multiplatformï¼‰
      - name: Generate Shared Logic
        uses: NikoToRA/claude-code-action@main
        with:
          prompt: |
            voice-koereq ã® Kotlin Multiplatform å…±æœ‰ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

            æ©Ÿèƒ½: ${{ steps.feature.outputs.feature_name }} (${{ steps.feature.outputs.feature_id }})

            è¦ä»¶:
            - expect/actual ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨
            - ä¸¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ä½¿ãˆã‚‹APIè¨­è¨ˆ
            - Coroutines Flow ã‚’ä½¿ç”¨
            - ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹

            ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:
            1. ${{ steps.feature.outputs.feature_id }}/Repository.kt - å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
            2. ${{ steps.feature.outputs.feature_id }}/Models.kt - ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
            3. ${{ steps.feature.outputs.feature_id }}/UseCase.kt - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
          output_path: shared/src/commonMain/kotlin/com/voicekoereq/
      
      # Azure Functionsï¼ˆå¿…è¦ãªå ´åˆï¼‰
      - name: Generate Azure Functions
        if: contains(fromJson('["ai_service", "backend"]'), steps.feature.outputs.feature_type)
        uses: NikoToRA/claude-code-action@main
        with:
          prompt: |
            voice-koereq ã® Azure Function ã‚’ C# ã§å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

            æ©Ÿèƒ½: ${{ steps.feature.outputs.feature_name }} (${{ steps.feature.outputs.feature_id }})

            è¦ä»¶:
            - .NET 8 Isolated Process
            - Azure ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®çµ±åˆï¼ˆSpeech Services, OpenAI, Storageï¼‰
            - Application Insights ã§ã®ãƒ­ã‚®ãƒ³ã‚°
            - é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            - æ—¥æœ¬èªå¯¾å¿œ
            - HTTPãƒˆãƒªã‚¬ãƒ¼

            å®Œå…¨ãªå®Ÿè£…ã‚’å«ã‚€ ${{ steps.feature.outputs.feature_id }}Function.cs ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
          output_path: azure-functions/
      
      # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
      - name: Generate Tests
        uses: NikoToRA/claude-code-action@main
        with:
          prompt: |
            ${{ steps.feature.outputs.feature_name }} ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

            å«ã‚ã‚‹ãƒ†ã‚¹ãƒˆ:
            ã€iOSã€‘
            - XCTest ã‚’ä½¿ã£ãŸ Unit tests
            - UI tests
            - Mock ã‚’ä½¿ã£ãŸçµ±åˆãƒ†ã‚¹ãƒˆ
            
            ã€Androidã€‘
            - JUnit ãƒ†ã‚¹ãƒˆ
            - Compose UI ãƒ†ã‚¹ãƒˆ
            - Mockito ã§ã®ãƒ¢ãƒƒã‚¯

            ãã‚Œãã‚Œã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç”¨ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
          output_path: tests/
      
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "âœ¨ Claude implementation: ${{ github.event.inputs.feature }}"
          title: "ğŸ¤– [Claude] ${{ github.event.inputs.feature }} Implementation"
          body: |
            ## Claude Auto-Generated Implementation
            
            ### å®Ÿè£…æ©Ÿèƒ½
            - **æ©Ÿèƒ½**: ${{ steps.feature.outputs.feature_name }}
            - **ID**: ${{ steps.feature.outputs.feature_id }}
            - **ã‚¿ã‚¤ãƒ—**: ${{ steps.feature.outputs.feature_type }}
            - **å„ªå…ˆåº¦**: ${{ steps.feature.outputs.feature_priority }}
            
            ### ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«
            - iOSå®Ÿè£…ï¼ˆSwiftUI + Combineï¼‰
            - Androidå®Ÿè£…ï¼ˆJetpack Compose + Kotlinï¼‰
            - å…±æœ‰ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆKotlin Multiplatformï¼‰
            - Azure Functionsï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰
            - ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
            
            ### ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ
            - [ ] ã‚³ãƒ¼ãƒ‰ã®å“è³ª
            - [ ] ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é©åˆ‡æ€§
            - [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            - [ ] æ—¥æœ¬èªå¯¾å¿œ
            
            ---
            *This PR was automatically generated by Claude AI using claude-code-action*
          branch: claude/${{ github.event.inputs.feature }}-${{ github.run_number }}
          labels: |
            claude-generated
            auto-implementation
            ${{ steps.feature.outputs.feature_type }}
            ${{ steps.feature.outputs.feature_priority }}